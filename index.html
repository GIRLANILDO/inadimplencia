<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inadimpl√™ncia √ìticas - Gest√£o Profissional</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-neon: #00f2ff;
            --secondary-neon: #7000ff;
            --bg-dark: #050505;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.25);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
            margin: 0;
        }

        .bg-animate {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: linear-gradient(45deg, #050505, #0a0a1a, #1a0525, #050505);
            background-size: 400% 400%; animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .glass-card {
            background: var(--glass-bg); backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px); border: 1px solid var(--glass-border);
            border-radius: 20px; box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
        }

        .form-control, .form-select {
            background: rgba(0, 0, 0, 0.6) !important;
            border: 1px solid var(--glass-border) !important;
            color: #fff !important;
            padding: 12px;
            border-radius: 10px;
        }

        .form-control:focus, .form-select:focus {
            background: rgba(0, 0, 0, 0.8) !important;
            border-color: var(--primary-neon) !important;
            color: #fff !important;
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.4) !important;
            outline: none;
        }

        .brand-logo {
            font-weight: 800; font-size: 1.8rem; text-align: center; margin-bottom: 30px;
            background: linear-gradient(to right, var(--primary-neon), var(--secondary-neon));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            letter-spacing: -1px; text-transform: uppercase;
        }

        .btn-neon {
            background: linear-gradient(45deg, var(--secondary-neon), var(--primary-neon));
            border: none; color: white; font-weight: 600; padding: 12px;
            border-radius: 10px; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px;
        }

        .sidebar {
            min-height: 100vh; background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px); border-right: 1px solid var(--glass-border);
        }

        .navbar-mobile {
            background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
        }

        .nav-link-custom {
            color: rgba(255,255,255,0.7); padding: 15px; border-radius: 10px;
            margin-bottom: 10px; transition: 0.3s; cursor: pointer; text-decoration: none; display: block;
        }

        .nav-link-custom:hover { background: var(--glass-bg); color: var(--primary-neon); }
        .table-hover tbody tr { cursor: pointer; transition: 0.2s; }
        .table-hover tbody tr:hover { background: rgba(0, 242, 255, 0.1) !important; }
        .modal-content { background: #0a0a1a; border: 1px solid var(--primary-neon); border-radius: 20px; color: #fff; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="bg-animate"></div>

    <!-- TELA DE LOGIN -->
    <div id="loginSection" class="container">
        <div class="login-container glass-card" style="max-width: 450px; margin: 6% auto; padding: 40px;">
            <div class="brand-logo">INADIMPL√äNCIA √ìTICAS</div>
            <h5 class="text-center mb-4" style="color: rgba(255,255,255,0.6); font-size: 0.9rem;">SISTEMA DE SEGURAN√áA</h5>
            <div id="loginError" class="alert alert-danger hidden">E-mail ou senha inv√°lidos.</div>
            <form id="loginForm" autocomplete="off">
                <div class="mb-3">
                    <label class="small">E-MAIL</label>
                    <input type="email" id="userEmail" class="form-control" placeholder="exemplo@email.com" required>
                </div>
                <div class="mb-4">
                    <label class="small">SENHA</label>
                    <input type="password" id="userPass" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-neon w-100 mb-3">Entrar</button>
                <div class="text-center"><a href="#" onclick="showRegister()" class="small text-info text-decoration-none">Criar acesso</a></div>
            </form>
            <div class="text-center mt-4 pt-3 border-top border-secondary small text-white-50">
                Desenvolvido por: <strong>Girlanildo</strong><br>Contato: (97) 991632841
            </div>
        </div>
    </div>

    <!-- TELA DE REGISTRO -->
    <div id="registerSection" class="container hidden">
        <div class="login-container glass-card" style="max-width: 450px; margin: 6% auto; padding: 40px;">
            <div class="brand-logo">NOVO OPERADOR</div>
            <form id="registerForm" autocomplete="off">
                <div class="mb-3"><label class="small">NOME COMPLETO</label><input type="text" id="regName" class="form-control" required></div>
                <div class="mb-3"><label class="small">E-MAIL</label><input type="email" id="regEmail" class="form-control" placeholder="seu@email.com" required></div>
                <div class="mb-4"><label class="small">SENHA</label><input type="password" id="regPass" class="form-control" required></div>
                <button type="submit" class="btn btn-neon w-100">Registrar</button>
                <button type="button" class="btn btn-link btn-sm w-100 mt-3 text-white-50" onclick="showLogin()">Voltar ao Login</button>
            </form>
        </div>
    </div>

    <!-- DASHBOARD PRINCIPAL -->
    <div id="mainSection" class="container-fluid hidden p-0">
        <nav class="navbar navbar-dark navbar-mobile d-md-none p-3">
            <span class="navbar-brand brand-logo mb-0" style="font-size: 1.1rem;">SISTEMA GEST√ÉO</span>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMobileContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navMobileContent">
                <div class="nav flex-column mt-3">
                    <a class="nav-link-custom" onclick="switchTab('lista')">üìä Meus Registros</a>
                    <a class="nav-link-custom" onclick="switchTab('cadastro')">‚ûï Novo Registro</a>
                    <a class="nav-link-custom" onclick="switchTab('relatorio')">üìë Relat√≥rio Geral</a>
                    <a class="nav-link-custom text-danger" onclick="logout()">üîì Sair</a>
                </div>
            </div>
        </nav>

        <div class="row g-0">
            <nav class="col-md-2 d-none d-md-block sidebar p-4">
                <div class="brand-logo mb-4" style="font-size: 1rem; text-align: left;">SISTEMA GEST√ÉO</div>
                <div class="mb-4 p-3 glass-card" style="font-size: 0.8rem;">
                    <span class="text-white-50 d-block">Operador:</span>
                    <strong id="currentUserDisplay" class="text-info"></strong>
                </div>
                <div class="nav flex-column">
                    <a class="nav-link-custom" onclick="switchTab('lista')">üìä Meus Registros</a>
                    <a class="nav-link-custom" onclick="switchTab('cadastro')">‚ûï Novo Registro</a>
                    <a class="nav-link-custom" onclick="switchTab('relatorio')">üìë Relat√≥rio Geral</a>
                    <a class="nav-link-custom text-danger mt-5" onclick="logout()">üîì Sair</a>
                </div>
            </nav>

            <main class="col-md-10 p-4 p-md-5">
                <!-- TAB LISTA -->
                <div id="tabLista">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3">
                        <h2 class="fw-bold mb-0">Consulta de Inadimplentes</h2>
                        <div>
                            <button class="btn btn-outline-info btn-sm px-3" onclick="clearFilters()">üßπ Limpar Filtros</button>
                            <button class="btn btn-outline-success btn-sm px-3 ms-2" onclick="printData()">üñ®Ô∏è Imprimir Relat√≥rio</button>
                        </div>
                    </div>
                    
                    <div class="glass-card p-4 mb-4">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="small text-white-50">BUSCAR POR CPF</label>
                                <input type="text" id="filterCPF" class="form-control cpf-mask" placeholder="000.000.000-00" onkeyup="renderTable()">
                            </div>
                            <div class="col-md-4">
                                <label class="small text-white-50">FILTRAR POR √ìTICA</label>
                                <select id="filterOtica" class="form-select" onchange="renderTable()">
                                    <option value="">Todas as √ìticas</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="small text-white-50">STATUS</label>
                                <select id="filterStatus" class="form-select" onchange="renderTable()">
                                    <option value="">Todos os Status</option>
                                    <option value="Pendente">Pendente</option>
                                    <option value="Pago">Pago</option>
                                    <option value="Negociado">Negociado</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card overflow-hidden">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0 text-white">
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>CPF</th>
                                        <th>√ìtica</th>
                                        <th>Valor</th>
                                        <th>Vencimento</th>
                                        <th>Status</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="inadimplentesTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- TAB RELATORIO -->
                <div id="tabRelatorio" class="hidden">
                    <h2 class="fw-bold mb-4">Relat√≥rio de Auditoria</h2>
                    <div class="glass-card overflow-hidden">
                        <div class="table-responsive">
                            <table class="table mb-0 text-white">
                                <thead><tr><th>Data</th><th>Cliente</th><th>Valor</th><th>√ìtica</th><th>Operador</th></tr></thead>
                                <tbody id="relatorioTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- TAB CADASTRO -->
                <div id="tabCadastro" class="hidden">
                    <div class="glass-card p-4 p-md-5">
                        <h2 id="formTitle" class="mb-4 fw-bold">Novo Cadastro</h2>
                        <form id="debtForm">
                            <input type="hidden" id="editId">
                            <div class="row g-4">
                                <div class="col-md-6"><label class="small text-white-50">NOME COMPLETO</label><input type="text" id="custName" class="form-control" required></div>
                                <div class="col-md-3"><label class="small text-white-50">NASCIMENTO</label><input type="date" id="custDOB" class="form-control" required></div>
                                <div class="col-md-3"><label class="small text-white-50">CPF</label><input type="text" id="custCPF" class="form-control cpf-mask" required></div>
                                <div class="col-md-4"><label class="small text-white-50">√ìTICA</label><input type="text" id="debtOtica" class="form-control" required></div>
                                <div class="col-md-4"><label class="small text-white-50">DATA COMPRA</label><input type="date" id="debtDate" class="form-control" required></div>
                                <div class="col-md-4"><label class="small text-white-50">VENCIMENTO</label><input type="date" id="debtDue" class="form-control" required></div>
                                <div class="col-md-4"><label class="small text-white-50">VALOR (R$)</label><input type="number" step="0.01" id="debtValue" class="form-control" required></div>
                                <div class="col-md-4"><label class="small text-white-50">STATUS</label><select id="debtStatus" class="form-select"><option value="Pendente">Pendente</option><option value="Pago">Pago</option><option value="Negociado">Negociado</option></select></div>
                                <div class="col-md-4 d-flex align-items-end pb-2">
                                    <div class="form-check me-3"><input class="form-check-input" type="checkbox" id="checkSPC"><label class="small">SPC</label></div>
                                    <div class="form-check"><input class="form-check-input" type="checkbox" id="checkProtesto"><label class="small">PROTESTO</label></div>
                                </div>
                                <div class="col-12"><label class="small text-white-50">OBSERVA√á√ïES IMPORTANTES</label><textarea id="debtObs" class="form-control" rows="3"></textarea></div>
                                <div class="col-12 mt-4">
                                    <button type="submit" class="btn btn-neon px-5 w-100 w-md-auto">Salvar Registro</button>
                                    <button type="button" class="btn btn-outline-light ms-0 ms-md-2 mt-2 mt-md-0 px-5 w-100 w-md-auto" onclick="switchTab('lista')">Cancelar</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- MODAL DETALHES -->
    <div class="modal fade" id="detailsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content glass-card">
                <div class="modal-header border-secondary"><h5 class="modal-title text-info fw-bold">DETALHES COMPLETOS</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
                <div class="modal-body" id="modalContent"></div>
                <div class="modal-footer border-secondary"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button></div>
            </div>
        </div>
    </div>

    <!-- SDK do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>



    <script>





        // --- CONFIGURA√á√ÉO FIREBASE (SUBSTITUA PELOS SEUS DADOS) ---
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyB78OCFuAT9Qm-X7FPgpVZhcds6gRC7QnY",
    authDomain: "inadimplencia-e7ac8.firebaseapp.com",
    projectId: "inadimplencia-e7ac8",
    storageBucket: "inadimplencia-e7ac8.firebasestorage.app",
    messagingSenderId: "1043062755960",
    appId: "1:1043062755960:web:f413430547e32192b5138d"
  };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;
    let detailsModal;

    document.addEventListener('DOMContentLoaded', () => {
        detailsModal = new bootstrap.Modal(document.getElementById('detailsModal'));





            
            // Monitorar estado de autentica√ß√£o
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = { name: user.displayName || 'Operador', email: user.email };
                    document.getElementById('currentUserDisplay').innerText = currentUser.name;
                    document.getElementById('loginSection').classList.add('hidden');
                    document.getElementById('mainSection').classList.remove('hidden');
                    switchTab('lista');
                } else {
                    document.getElementById('mainSection').classList.add('hidden');
                    document.getElementById('loginSection').classList.remove('hidden');
                }
            });
        });

        // UTILIT√ÅRIOS
        function applyCPFMask(v) {
            v = v.replace(/\D/g, "");
            if (v.length > 11) v = v.slice(0, 11);
            return v.replace(/(\d{3})(\d)/, "$1.$2").replace(/(\d{3})(\d)/, "$1.$2").replace(/(\d{3})(\d{1,2})$/, "$1-$2");
        }
        document.querySelectorAll('.cpf-mask').forEach(i => i.addEventListener('input', e => e.target.value = applyCPFMask(e.target.value)));

        // NAVEGA√á√ÉO
        function showRegister() { document.getElementById('loginSection').classList.add('hidden'); document.getElementById('registerSection').classList.remove('hidden'); }
        function showLogin() { document.getElementById('registerSection').classList.add('hidden'); document.getElementById('loginSection').classList.remove('hidden'); }

        async function logout() {
            await auth.signOut();
        }

        // LOGIN E REGISTRO FIREBASE
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPass').value;
            try {
                const userCred = await auth.createUserWithEmailAndPassword(email, pass);
                await userCred.user.updateProfile({ displayName: name });
                alert("Operador registrado!");
                showLogin();
            } catch (error) { alert("Erro ao registrar: " + error.message); }
        });

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('userEmail').value;
            const pass = document.getElementById('userPass').value;
            try {
                await auth.signInWithEmailAndPassword(email, pass);
                document.getElementById('loginError').classList.add('hidden');
            } catch (error) { document.getElementById('loginError').classList.remove('hidden'); }
        });

        // GEST√ÉO DE DADOS (FIRESTORE)
        document.getElementById('debtForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const editId = document.getElementById('editId').value;
            const debtData = {
                customerName: document.getElementById('custName').value,
                dob: document.getElementById('custDOB').value,
                cpf: document.getElementById('custCPF').value,
                store: document.getElementById('debtOtica').value,
                purchaseDate: document.getElementById('debtDate').value,
                dueDate: document.getElementById('debtDue').value,
                amount: document.getElementById('debtValue').value,
                status: document.getElementById('debtStatus').value,
                spc: document.getElementById('checkSPC').checked,
                protesto: document.getElementById('checkProtesto').checked,
                obs: document.getElementById('debtObs').value,
                userName: currentUser.name,
                userEmail: currentUser.email,
                createdAt: editId ? null : new Date().toLocaleDateString('pt-BR')
            };

            try {
                if (editId) {
                    delete debtData.createdAt; // N√£o mudar a data de cria√ß√£o no edit
                    await db.collection('debts').doc(editId).update(debtData);
                } else {
                    await db.collection('debts').add(debtData);
                }
                switchTab('lista');
            } catch (error) { alert("Erro ao salvar: " + error.message); }
        });

        function switchTab(tab) {
            const menu = document.getElementById('navMobileContent');
            if(menu && menu.classList.contains('show')) bootstrap.Collapse.getInstance(menu).hide();
            document.querySelectorAll('main > div').forEach(d => d.classList.add('hidden'));
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.remove('hidden');
            if(tab === 'lista') { renderTable(); }
            else if(tab === 'cadastro') { 
                if(!document.getElementById('editId').value) {
                    document.getElementById('debtForm').reset();
                    document.getElementById('formTitle').innerText = "Novo Cadastro";
                }
            }
            else if(tab === 'relatorio') renderReport();
        }

        async function renderTable() {
            const tbody = document.getElementById('inadimplentesTable');
            const fCPF = document.getElementById('filterCPF').value;
            const fOtica = document.getElementById('filterOtica').value;
            const fStatus = document.getElementById('filterStatus').value;
            
            tbody.innerHTML = '<tr><td colspan="7" class="text-center">Carregando...</td></tr>';
            
            try {
                const snapshot = await db.collection('debts').get();
                allDebts = [];
                snapshot.forEach(doc => allDebts.push({ id: doc.id, ...doc.data() }));
                
                updateOticaFilter();
                tbody.innerHTML = '';
                
                const filtered = allDebts.filter(d => 
                    d.cpf.includes(fCPF) && 
                    (fOtica === "" || d.store === fOtica) && 
                    (fStatus === "" || d.status === fStatus)
                );

                filtered.forEach(d => {
                    const isOwner = (d.userEmail === currentUser.email || currentUser.email === 'admin@admin.com');
                    tbody.innerHTML += `
                        <tr onclick="viewDetails('${d.id}')">
                            <td><strong>${d.customerName}</strong></td>
                            <td>${d.cpf}</td>
                            <td>${d.store}</td>
                            <td>R$ ${parseFloat(d.amount).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                            <td>${new Date(d.dueDate + 'T00:00:00').toLocaleDateString('pt-BR')}</td>
                            <td><span class="badge ${d.status === 'Pago' ? 'bg-success' : d.status === 'Pendente' ? 'bg-danger' : 'bg-warning text-dark'}">${d.status}</span></td>
                            <td>
                                ${isOwner ? `
                                    <button class="btn btn-sm btn-outline-info" onclick="event.stopPropagation(); editDebt('${d.id}')">‚úèÔ∏è</button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="event.stopPropagation(); deleteDebt('${d.id}')">üóëÔ∏è</button>
                                ` : 'üîí'}
                            </td>
                        </tr>`;
                });
            } catch (error) { console.error(error); }
        }

        function updateOticaFilter() {
            const select = document.getElementById('filterOtica');
            const currentVal = select.value;
            const oticasUnicas = [...new Set(allDebts.map(d => d.store))].sort();
            select.innerHTML = '<option value="">Todas as √ìticas</option>';
            oticasUnicas.forEach(otica => { 
                select.innerHTML += `<option value="${otica}" ${currentVal === otica ? 'selected' : ''}>${otica}</option>`; 
            });
        }

        function viewDetails(id) {
            const d = allDebts.find(debt => debt.id === id);
            document.getElementById('modalContent').innerHTML = `<div class="row g-3"><div class="col-md-6"><p class="small text-white-50 mb-0">NOME</p><h5>${d.customerName}</h5></div><div class="col-md-6"><p class="small text-white-50 mb-0">CPF</p><h5>${d.cpf}</h5></div><hr class="border-secondary"><div class="col-md-4"><p class="small text-white-50 mb-0">√ìTICA</p><p>${d.store}</p></div><div class="col-md-4"><p class="small text-white-50 mb-0">D√çVIDA</p><p class="text-info">R$ ${parseFloat(d.amount).toLocaleString('pt-BR')}</p></div><div class="col-md-4"><p class="small text-white-50 mb-0">STATUS</p><p>${d.status}</p></div><div class="col-md-4"><p class="small text-white-50 mb-0">COMPRA</p><p>${new Date(d.purchaseDate + 'T00:00:00').toLocaleDateString('pt-BR')}</p></div><div class="col-md-4"><p class="small text-white-50 mb-0">VENCIMENTO</p><p>${new Date(d.dueDate + 'T00:00:00').toLocaleDateString('pt-BR')}</p></div><div class="col-md-4"><p class="small text-white-50 mb-0">NASCIMENTO</p><p>${new Date(d.dob + 'T00:00:00').toLocaleDateString('pt-BR')}</p></div><hr class="border-secondary"><div class="col-md-6"><p class="small text-white-50 mb-0">SPC/SERASA</p><p>${d.spc?'‚úÖ Sim':'‚ùå N√£o'}</p></div><div class="col-md-6"><p class="small text-white-50 mb-0">PROTESTO</p><p>${d.protesto?'‚úÖ Sim':'‚ùå N√£o'}</p></div><div class="col-12 glass-card p-3"><p class="small text-info fw-bold mb-1">OBSERVA√á√ïES:</p><p style="white-space:pre-wrap">${d.obs||'...'}</p></div><div class="text-end small text-white-50 mt-3">Operador: ${d.userName} em ${d.createdAt}</div></div>`;
            detailsModal.show();
        }

        function editDebt(id) {
            const d = allDebts.find(debt => debt.id === id);
            document.getElementById('editId').value = d.id;
            document.getElementById('custName').value = d.customerName;
            document.getElementById('custDOB').value = d.dob;
            document.getElementById('custCPF').value = d.cpf;
            document.getElementById('debtOtica').value = d.store;
            document.getElementById('debtDate').value = d.purchaseDate;
            document.getElementById('debtDue').value = d.dueDate;
            document.getElementById('debtValue').value = d.amount;
            document.getElementById('debtStatus').value = d.status;
            document.getElementById('checkSPC').checked = d.spc;
            document.getElementById('checkProtesto').checked = d.protesto;
            document.getElementById('debtObs').value = d.obs;
            document.getElementById('formTitle').innerText = "Editar Registro";
            switchTab('cadastro');
        }

        async function deleteDebt(id) {
            if (confirm("Confirmar exclus√£o definitiva?")) {
                await db.collection('debts').doc(id).delete();
                renderTable();
            }
        }

        function clearFilters() { document.getElementById('filterCPF').value = ''; document.getElementById('filterOtica').value = ''; document.getElementById('filterStatus').value = ''; renderTable(); }
        
        function renderReport() {
            const tbody = document.getElementById('relatorioTable'); tbody.innerHTML = '';
            allDebts.forEach(d => tbody.innerHTML += `<tr><td>${d.createdAt}</td><td>${d.customerName}</td><td>R$ ${d.amount}</td><td>${d.store}</td><td class="text-info">${d.userName}</td></tr>`);
        }

        function printData() {
            const fCPF = document.getElementById('filterCPF').value;
            const fOtica = document.getElementById('filterOtica').value;
            const fStatus = document.getElementById('filterStatus').value;
            const filtered = allDebts.filter(d => d.cpf.includes(fCPF) && (fOtica === "" || d.store === fOtica) && (fStatus === "" || d.status === fStatus));

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Relat√≥rio de Inadimpl√™ncia</title>
                    <style>
                        @page { size: landscape; margin: 1cm; }
                        body { font-family: sans-serif; font-size: 9pt; color: #333; }
                        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
                        th, td { border: 1px solid #999; padding: 6px; text-align: left; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <h2>RELAT√ìRIO DE CLIENTES INADIMPLENTES</h2>
                    <p>Filtros: √ìtica ${fOtica || 'Todas'} | Status ${fStatus || 'Todos'}</p>
                    <table>
                        <thead>
                            <tr><th>Nome</th><th>CPF</th><th>√ìtica</th><th>Vencimento</th><th>Valor</th><th>Status</th></tr>
                        </thead>
                        <tbody>
                            ${filtered.map(d => `<tr><td>${d.customerName}</td><td>${d.cpf}</td><td>${d.store}</td><td>${new Date(d.dueDate + 'T00:00:00').toLocaleDateString('pt-BR')}</td><td>R$ ${d.amount}</td><td>${d.status}</td></tr>`).join('')}
                        </tbody>
                    </table>
                </body>
                </html>
            `);
            printWindow.document.close();
            setTimeout(() => { printWindow.print(); printWindow.close(); }, 500);
        }
    </script>
</body>
</html>